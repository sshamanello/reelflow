<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReelFlow ‚Äî Content Automation Platform</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            // Dark theme palette
            background: {
              900: '#0a0a0b',
              800: '#131316',
              700: '#1a1a1f',
              600: '#23232a',
            },
            surface: {
              DEFAULT: '#1a1a1f',
              hover: '#23232a',
              border: '#2a2a35',
            },
            // Light theme palette
            light: {
              background: '#f8fafc',
              surface: '#ffffff',
              border: '#e2e8f0',
              hover: '#f1f5f9',
              text: '#1e293b',
              textSecondary: '#64748b',
              textMuted: '#94a3b8',
            },
            primary: {
              DEFAULT: '#14b8a6',
              50: '#f0fdfa',
              100: '#ccfbf1',
              200: '#99f6e4',
              300: '#5eead4',
              400: '#2dd4bf',
              500: '#14b8a6',
              600: '#0d9488',
              700: '#0f766e',
              800: '#115e59',
              900: '#134e4a',
            },
            accent: {
              DEFAULT: '#f97316',
              50: '#fff7ed',
              100: '#ffedd5',
              200: '#fed7aa',
              300: '#fdba74',
              400: '#fb923c',
              500: '#f97316',
              600: '#ea580c',
              700: '#c2410c',
              800: '#9a3412',
              900: '#7c2d12',
            },
            success: '#10b981',
            warning: '#f59e0b',
            error: '#ef4444',
            info: '#3b82f6',
          },
          fontFamily: {
            sans: ['Inter', 'SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-in-out',
            'slide-up': 'slideUp 0.4s ease-out',
            'slide-in-right': 'slideInRight 0.3s ease-out',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(10px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            slideInRight: {
              '0%': { transform: 'translateX(-10px)', opacity: '0' },
              '100%': { transform: 'translateX(0)', opacity: '1' },
            },
          },
        },
      },
    }
  </script>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: #0a0a0b;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body.light {
      background: #f8fafc;
    }

    /* Custom scrollbar - Dark */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #131316;
    }

    ::-webkit-scrollbar-thumb {
      background: #2a2a35;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #3a3a45;
    }

    /* Custom scrollbar - Light */
    body.light ::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    body.light ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
    }

    body.light ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    /* Smooth transitions */
    .transition-smooth {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Subtle grid pattern - Dark */
    .grid-pattern {
      background-image: linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
      background-size: 50px 50px;
    }

    /* Subtle grid pattern - Light */
    body.light .grid-pattern {
      background-image: linear-gradient(rgba(0, 0, 0, 0.03) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
    }

    /* Chart bars animation */
    @keyframes growUp {
      from { transform: scaleY(0); }
      to { transform: scaleY(1); }
    }

    .chart-bar {
      transform-origin: bottom;
      animation: growUp 0.6s ease-out forwards;
    }

    /* Status indicator pulse */
    @keyframes statusPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .status-active {
      animation: statusPulse 2s ease-in-out infinite;
    }
  </style>
</head>
<body class="bg-background-900 text-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // ====== TRANSLATIONS ======
    const translations = {
      en: {
        // Navigation
        navDashboard: "Dashboard",
        navProjects: "Projects",
        navScheduler: "Scheduler",
        navUploads: "Uploads",
        navAnalytics: "Analytics",
        navSettings: "Settings",

        // Header
        searchPlaceholder: "Search projects, videos...",
        notifications: "Notifications",

        // KPI Cards
        kpiUploaded: "Uploaded Videos",
        kpiScheduled: "Scheduled Posts",
        kpiPublished: "Published Videos",
        kpiErrors: "Errors",
        kpiThisWeek: "This week",
        kpiAllTime: "All time",

        // Analytics
        analyticsTitle: "Activity Overview",
        analyticsPlatforms: "Platform Distribution",
        last7Days: "Last 7 days",

        // Recent Activity
        recentActivity: "Recent Activity",
        activityVideoUploaded: "Video uploaded to",
        activityPublished: "Published to",
        activityScheduled: "Scheduled for",
        activityError: "Upload failed to",

        // Projects
        projectsTitle: "Projects & Channels",
        createProject: "Create Project",
        videos: "videos",
        lastActive: "Last active",
        active: "Active",
        paused: "Paused",

        // Scheduler
        schedulerTitle: "Content Pipeline",
        todo: "To Do",
        inProgress: "In Progress",
        done: "Done",
        uploadTask: "Upload videos",
        scheduleTask: "Schedule posts",
        reviewTask: "Review content",

        // Status
        statusUploading: "Uploading",
        statusScheduled: "Scheduled",
        statusPublished: "Published",
        statusFailed: "Failed",

        // Actions
        viewAll: "View All",
        addNew: "Add New",
        export: "Export",
        quickActions: "Quick Actions",

        // Time
        justNow: "Just now",
        minutesAgo: "{minutes}m ago",
        hoursAgo: "{hours}h ago",
        daysAgo: "{days}d ago",
      },
      ru: {
        // Navigation
        navDashboard: "–î–∞—à–±–æ—Ä–¥",
        navProjects: "–ü—Ä–æ–µ–∫—Ç—ã",
        navScheduler: "–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫",
        navUploads: "–ó–∞–≥—Ä—É–∑–∫–∏",
        navAnalytics: "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
        navSettings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",

        // Header
        searchPlaceholder: "–ü–æ–∏—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤, –≤–∏–¥–µ–æ...",
        notifications: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",

        // KPI Cards
        kpiUploaded: "–ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤–∏–¥–µ–æ",
        kpiScheduled: "–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –ø–æ—Å—Ç–æ–≤",
        kpiPublished: "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤–∏–¥–µ–æ",
        kpiErrors: "–û—à–∏–±–∫–∏",
        kpiThisWeek: "–ó–∞ –Ω–µ–¥–µ–ª—é",
        kpiAllTime: "–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è",

        // Analytics
        analyticsTitle: "–û–±–∑–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
        analyticsPlatforms: "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º",
        last7Days: "–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",

        // Recent Activity
        recentActivity: "–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
        activityVideoUploaded: "–í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤",
        activityPublished: "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤",
        activityScheduled: "–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞",
        activityError: "–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å –≤",

        // Projects
        projectsTitle: "–ü—Ä–æ–µ–∫—Ç—ã –∏ –∫–∞–Ω–∞–ª—ã",
        createProject: "–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç",
        videos: "–≤–∏–¥–µ–æ",
        lastActive: "–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
        active: "–ê–∫—Ç–∏–≤–µ–Ω",
        paused: "–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω",

        // Scheduler
        schedulerTitle: "–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–∞–π–ø–ª–∞–π–Ω",
        todo: "–ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é",
        inProgress: "–í —Ä–∞–±–æ—Ç–µ",
        done: "–ì–æ—Ç–æ–≤–æ",
        uploadTask: "–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ",
        scheduleTask: "–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã",
        reviewTask: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç",

        // Status
        statusUploading: "–ó–∞–≥—Ä—É–∑–∫–∞",
        statusScheduled: "–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ",
        statusPublished: "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ",
        statusFailed: "–û—à–∏–±–∫–∞",

        // Actions
        viewAll: "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ",
        addNew: "–î–æ–±–∞–≤–∏—Ç—å",
        export: "–≠–∫—Å–ø–æ—Ä—Ç",
        quickActions: "–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è",

        // Time
        justNow: "–¢–æ–ª—å–∫–æ —á—Ç–æ",
        minutesAgo: "{minutes}–º –Ω–∞–∑–∞–¥",
        hoursAgo: "{hours}—á –Ω–∞–∑–∞–¥",
        daysAgo: "{days}–¥ –Ω–∞–∑–∞–¥",
      },
    };

    // ====== ICONS ======
    const Icons = {
      Dashboard: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
        </svg>
      ),
      Projects: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
        </svg>
      ),
      Scheduler: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
      ),
      Uploads: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
        </svg>
      ),
      Analytics: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg>
      ),
      Settings: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
      ),
      Search: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      ),
      Bell: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
        </svg>
      ),
      ChevronDown: () => (
        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
        </svg>
      ),
      TrendUp: () => (
        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
        </svg>
      ),
      Sun: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
      ),
      Moon: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
      ),
      Check: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
        </svg>
      ),
      TikTok: () => (
        <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.84 6.84 0 00-1-.05A6.33 6.33 0 005 20.1a6.34 6.34 0 0010.86-4.43v-7a8.16 8.16 0 004.77 1.52v-3.4a4.85 4.85 0 01-1-.1z"/>
        </svg>
      ),
      Instagram: () => (
        <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 01-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 017.8 2m-.2 2A3.6 3.6 0 004 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 003.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 011.25 1.25A1.25 1.25 0 0117.25 8 1.25 1.25 0 0116 6.75a1.25 1.25 0 011.25-1.25M12 7a5 5 0 015 5 5 5 0 01-5 5 5 5 0 01-5-5 5 5 0 015-5m0 2a3 3 0 00-3 3 3 3 0 003 3 3 3 0 003-3 3 3 0 00-3-3z"/>
        </svg>
      ),
      YouTube: () => (
        <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M10 15l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83-.25.9-.83 1.48-1.73 1.73-.47.13-1.33.22-2.65.28-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44-.9-.25-1.48-.83-1.73-1.73-.13-.47-.22-1.1-.28-1.9-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83.25-.9.83-1.48 1.73-1.73.47-.13 1.33-.22 2.65-.28 1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44.9.25 1.48.83 1.73 1.73z"/>
        </svg>
      ),
      Plus: () => (
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
        </svg>
      ),
    };

    // ====== CONFIG ======
    const API_BASE = 'https://reelflow-worker.sshamanello.workers.dev';
    const CONFIG = {
      API_BASE: API_BASE,
      REDIRECT_URI: 'https://sshamanello.ru/ReelFlow', // –±–µ–∑ —Å–ª–µ—à–∞ –≤ –∫–æ–Ω—Ü–µ!
      tiktok: {
        authUrl: 'https://www.tiktok.com/v2/auth/authorize',
        clientKey: 'awz0u4dkl7733fhp',
        scopes: ['user.info.basic', 'video.upload', 'video.publish']
      },
      youtube: {
        authUrl: 'https://accounts.google.com/o/oauth2/v2/auth',
        clientId: '651052782933-l5lh624e5ssrianbj4ln9ge8stbs6s4e.apps.googleusercontent.com',
        scopes: ['https://www.googleapis.com/auth/youtube.upload', 'https://www.googleapis.com/auth/youtubepartner']
      }
    };

    // ====== API CLIENT ======
    // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π session ID –∏–∑ localStorage
    function getSessionId() {
      return localStorage.getItem('reelflow_sid');
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º session ID –≤ localStorage
    function saveSessionId(sid) {
      localStorage.setItem('reelflow_sid', sid);
      console.log('[Session] Saved sid:', sid);
    }

    // –£–¥–∞–ª—è–µ–º session ID (logout)
    function clearSessionId() {
      localStorage.removeItem('reelflow_sid');
      console.log('[Session] Cleared sid');
    }

    async function apiRequest(endpoint, options = {}) {
      const url = `${CONFIG.API_BASE}${endpoint}`;
      const sid = getSessionId();

      const opts = {
        ...options,
        headers: {
          'Content-Type': 'application/json',
          ...options.headers,
        },
        // –£–±–∏—Ä–∞–µ–º credentials: 'include' - –Ω–µ –Ω—É–∂–Ω–æ –¥–ª—è cross-origin —Å localStorage
      };

      // –î–æ–±–∞–≤–ª—è–µ–º sid –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization, –µ—Å–ª–∏ –µ—Å—Ç—å
      if (sid) {
        opts.headers['Authorization'] = `Bearer ${sid}`;
      }

      console.log('[API] Request:', endpoint, 'Sid:', sid?.substring(0, 10) + '...');

      const response = await fetch(url, opts);
      const data = await response.json().catch(() => null);

      if (!response.ok) {
        throw new Error(data?.error || `HTTP ${response.status}`);
      }

      // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–æ–≤—ã–π sid - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ
      if (data.sid && data.sid !== sid) {
        saveSessionId(data.sid);
      }

      return data;
    }

    // ====== OAUTH HELPERS ======
    function openPlatformAuth(platform) {
      const config = CONFIG[platform];
      const state = Math.random().toString(36).substring(7);

      console.log('[OAuth] Platform:', platform);
      console.log('[OAuth] Config:', config);
      console.log('[OAuth] Redirect URI:', CONFIG.REDIRECT_URI);

      let authUrl;
      if (platform === 'tiktok') {
        const scopes = config.scopes.join(',');
        authUrl = `${config.authUrl}?client_key=${config.clientKey}&scope=${encodeURIComponent(scopes)}&redirect_uri=${encodeURIComponent(CONFIG.REDIRECT_URI)}&response_type=code&state=${state}`;
      } else if (platform === 'youtube') {
        const scopes = config.scopes.join(' ');
        authUrl = `${config.authUrl}?client_id=${config.clientId}&redirect_uri=${encodeURIComponent(CONFIG.REDIRECT_URI)}&response_type=code&scope=${encodeURIComponent(scopes)}&access_type=offline&state=${state}`;
      }

      console.log('[OAuth] Auth URL:', authUrl);
      const popup = window.open(authUrl, '_blank', 'width=600,height=700');
      console.log('[OAuth] Popup opened:', popup);

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É popup
      if (!popup || popup.closed || typeof popup.closed == 'undefined') {
        console.error('[OAuth] Popup was blocked! Please allow popups for this site.');
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
      }

      return popup;
    }

    async function exchangePlatformCode(platform, code) {
      return await apiRequest('/api/oauth/exchange', {
        method: 'POST',
        body: JSON.stringify({ platform, code, redirect_uri: CONFIG.REDIRECT_URI }),
      });
    }

    async function uploadVideo(file) {
      const formData = new FormData();
      formData.append('file', file);

      const sid = getSessionId();
      const headers = {};
      if (sid) {
        headers['Authorization'] = `Bearer ${sid}`;
      }

      const response = await fetch(`${API_BASE}/api/tiktok/upload`, {
        method: 'POST',
        headers,
        body: formData,
      });

      if (!response.ok) {
        let errorDetail = '';
        try {
          const errorData = await response.json();
          console.error('[uploadVideo] Error response:', errorData);

          // Extract TikTok error code if available
          if (errorData.detail?.error?.code) {
            errorDetail = `: ${errorData.detail.error.code}`;
          } else if (errorData.error) {
            errorDetail = `: ${errorData.error}`;
          }
        } catch (e) {
          // If parsing fails, use status text
          errorDetail = await response.text();
        }

        throw new Error(`Upload failed: ${response.status} ${response.statusText}${errorDetail}`);
      }

      return await response.json();
    }

    // ====== DUMMY DATA ======
    const kpiData = {
      uploaded: { value: 1247, change: 12.5, trend: 'up' },
      scheduled: { value: 384, change: 8.2, trend: 'up' },
      published: { value: 892, change: -2.1, trend: 'down' },
      errors: { value: 23, change: -15.3, trend: 'up' },
    };

    const projectsData = [
      {
        id: 1,
        name: "Tech Reviews Channel",
        platforms: ['tiktok', 'youtube'],
        videos: 234,
        lastActive: '2h ago',
        status: 'active',
      },
      {
        id: 2,
        name: "Lifestyle Brand",
        platforms: ['instagram', 'tiktok'],
        videos: 156,
        lastActive: '5h ago',
        status: 'active',
      },
      {
        id: 3,
        name: "Educational Content",
        platforms: ['youtube', 'tiktok', 'instagram'],
        videos: 412,
        lastActive: '1d ago',
        status: 'paused',
      },
      {
        id: 4,
        name: "Product Demos",
        platforms: ['tiktok'],
        videos: 89,
        lastActive: '3d ago',
        status: 'active',
      },
    ];

    const activityData = [
      { id: 1, type: 'upload', platform: 'TikTok', video: 'Review #234', time: '2m ago', status: 'success' },
      { id: 2, type: 'publish', platform: 'Instagram', video: 'Lifestyle clip', time: '15m ago', status: 'success' },
      { id: 3, type: 'schedule', platform: 'YouTube', video: 'Tutorial #45', time: '1h ago', status: 'success' },
      { id: 4, type: 'error', platform: 'TikTok', video: 'Short #189', time: '2h ago', status: 'error' },
      { id: 5, type: 'upload', platform: 'YouTube', video: 'Demo #12', time: '3h ago', status: 'success' },
    ];

    const scheduleData = {
      todo: [
        { id: 1, title: "Upload batch videos", project: "Tech Reviews", priority: "high" },
        { id: 2, title: "Review scheduled content", project: "Lifestyle Brand", priority: "medium" },
      ],
      inProgress: [
        { id: 3, title: "Schedule 50 posts", project: "Educational", priority: "high", progress: 65 },
        { id: 4, title: "Batch processing", project: "Product Demos", priority: "low", progress: 30 },
      ],
      done: [
        { id: 5, title: "Connect TikTok account", project: "Tech Reviews", priority: "high" },
        { id: 6, title: "Create automation workflow", project: "Lifestyle Brand", priority: "medium" },
      ],
    };

    const chartData = [65, 45, 78, 52, 83, 69, 91];

    // ====== UI COMPONENTS ======
    function KPICard({ title, value, change, trend, delay }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);
      const isPositive = trend === 'up' && change > 0 || trend === 'down' && change < 0;

      return (
        <div
          className={`border rounded-2xl p-6 transition-smooth hover:shadow-lg animate-slide-up ${
            isDark
              ? 'bg-surface border-surface-border hover:border-gray-700'
              : 'bg-white border-light-border hover:border-gray-300 hover:shadow-xl'
          }`}
          style={{ animationDelay: `${delay}ms` }}
        >
          <div className="flex items-start justify-between mb-4">
            <div className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>{title}</div>
            <div className={`flex items-center gap-1 text-xs font-semibold ${
              isPositive ? 'text-success' : 'text-error'
            }`}>
              <Icons.TrendUp />
              <span>{Math.abs(change)}%</span>
            </div>
          </div>
          <div className={`text-3xl font-bold mb-2 ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>{value.toLocaleString()}</div>
          <div className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>{t.kpiThisWeek}</div>
        </div>
      );
    }

    function ActivityChart({ data }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);

      // Show empty state if no data or all zeros
      const hasData = data && data.length > 0 && data.some(v => v > 0);

      if (!hasData) {
        return (
          <div className={`border rounded-2xl p-6 ${isDark ? 'bg-surface border-surface-border' : 'bg-white border-light-border'}`}>
            <div className="flex items-center justify-between mb-6">
              <div>
                <div className={`text-lg font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                  {t.analyticsTitle}
                </div>
                <div className={`text-sm mt-1 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                  {t.last7Days}
                </div>
              </div>
            </div>
            <div className="h-48 flex items-center justify-center">
              <div className="text-center">
                <div className="text-4xl mb-3">üìà</div>
                <p className={`text-sm ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                  {lang === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö' : 'Not enough data'}
                </p>
                <p className={`text-xs mt-1 ${isDark ? 'text-gray-600' : 'text-gray-500'}`}>
                  {lang === 'ru' ? '–ì—Ä–∞—Ñ–∏–∫ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏' : 'Chart will appear after first upload'}
                </p>
              </div>
            </div>
          </div>
        );
      }

      const maxValue = Math.max(...data);

      return (
        <div className={`border rounded-2xl p-6 ${isDark ? 'bg-surface border-surface-border' : 'bg-white border-light-border'}`}>
          <div className="flex items-center justify-between mb-6">
            <div>
              <div className={`text-lg font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                {t.analyticsTitle}
              </div>
              <div className={`text-sm mt-1 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                {t.last7Days}
              </div>
            </div>
            <button className="text-sm text-primary hover:text-primary-400 font-medium transition-smooth">
              {t.viewAll}
            </button>
          </div>

          <div className="flex items-end justify-between gap-3 h-48">
            {data.map((value, index) => (
              <div key={index} className="flex-1 flex flex-col items-center gap-2">
                <div
                  className="w-full bg-gradient-to-t from-primary to-primary-400 rounded-t-lg chart-bar"
                  style={{
                    height: `${(value / maxValue) * 100}%`,
                    animationDelay: `${index * 80}ms`
                  }}
                />
                <div className={`text-xs font-medium ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                  {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'][index]}
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function PlatformDistribution({ platforms = [] }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);

      return (
        <div className={`border rounded-2xl p-6 ${isDark ? 'bg-surface border-surface-border' : 'bg-white border-light-border'}`}>
          <div className={`text-lg font-semibold mb-6 ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
            {t.analyticsPlatforms}
          </div>
          {platforms.length > 0 ? (
            <div className="space-y-4">
              {platforms.map((platform) => (
                <div key={platform.name}>
                  <div className="flex items-center justify-between mb-2">
                    <span className={`text-sm font-medium ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                      {platform.name}
                    </span>
                    <span className={`text-sm ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                      {platform.percentage}%
                    </span>
                  </div>
                  <div className={`h-2 rounded-full overflow-hidden ${isDark ? 'bg-background-700' : 'bg-gray-200'}`}>
                    <div
                      className={`h-full ${platform.color} rounded-full transition-all duration-500`}
                      style={{ width: `${platform.percentage}%` }}
                    />
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="h-40 flex items-center justify-center">
              <div className="text-center">
                <div className="text-3xl mb-2">üìä</div>
                <p className={`text-sm ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                  {lang === 'ru' ? '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö' : 'No data'}
                </p>
                <p className={`text-xs mt-1 ${isDark ? 'text-gray-600' : 'text-gray-500'}`}>
                  {lang === 'ru' ? '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ' : 'Statistics will appear later'}
                </p>
              </div>
            </div>
          )}
        </div>
      );
    }

    function RecentActivity({ profiles, activities = [] }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);

      // Check if user has connected accounts
      const hasConnectedAccount = profiles && (profiles.tiktok || profiles.youtube);

      const getActivityMessage = (activity) => {
        switch (activity.type) {
          case 'upload':
            return `${t.activityVideoUploaded} ${activity.platform}`;
          case 'publish':
            return `${t.activityPublished} ${activity.platform}`;
          case 'schedule':
            return `${t.activityScheduled} ${activity.platform}`;
          case 'error':
            return `${t.activityError} ${activity.platform}`;
          default:
            return '';
        }
      };

      // Don't show if no connected account
      if (!hasConnectedAccount) {
        return null;
      }

      return (
        <div className={`border rounded-2xl p-6 ${isDark ? 'bg-surface border-surface-border' : 'bg-white border-light-border'}`}>
          <div className="flex items-center justify-between mb-6">
            <div className={`text-lg font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
              {t.recentActivity}
            </div>
            <button className="text-sm text-primary hover:text-primary-400 font-medium transition-smooth">
              {t.viewAll}
            </button>
          </div>

          <div className="space-y-4">
            {activities.length > 0 ? (
              activities.map((activity) => (
                <div
                  key={activity.id}
                  className={`flex items-start gap-4 p-3 rounded-xl transition-smooth ${
                    isDark ? 'hover:bg-background-700' : 'hover:bg-gray-50'
                  }`}
                >
                  <div className={`w-2 h-2 rounded-full mt-2 status-active ${
                    activity.status === 'success' ? 'bg-success' : 'bg-error'
                  }`} />
                  <div className="flex-1 min-w-0">
                    <div className={`text-sm font-medium truncate ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                      {activity.video}
                    </div>
                    <div className={`text-xs mt-1 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                      {getActivityMessage(activity)}
                    </div>
                  </div>
                  <div className={`text-xs font-medium ${isDark ? 'text-gray-600' : 'text-gray-500'}`}>
                    {activity.time}
                  </div>
                </div>
              ))
            ) : (
              <div className="text-center py-12">
                <div className="text-4xl mb-3">üì≠</div>
                <p className={`text-sm ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                  {lang === 'ru' ? '–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏' : 'No activity yet'}
                </p>
                <p className={`text-xs mt-1 ${isDark ? 'text-gray-600' : 'text-gray-500'}`}>
                  {lang === 'ru' ? '–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫' : 'Your upload history will appear here'}
                </p>
              </div>
            )}
          </div>
        </div>
      );
    }

    function ProjectCard({ project, onClick }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);

      const getPlatformIcon = (platform) => {
        switch (platform) {
          case 'tiktok': return <Icons.TikTok />;
          case 'instagram': return <Icons.Instagram />;
          case 'youtube': return <Icons.YouTube />;
          default: return null;
        }
      };

      return (
        <div
          onClick={onClick}
          className={`border rounded-2xl p-5 transition-smooth hover:shadow-lg cursor-pointer group relative ${
            isDark
              ? 'bg-surface border-surface-border hover:border-gray-700'
              : 'bg-white border-light-border hover:border-gray-300 hover:shadow-xl'
          }`}
        >
          {/* Hover overlay hint */}
          <div className="absolute inset-0 bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity rounded-2xl flex items-center justify-center">
            <span className="text-primary font-semibold text-sm">Click to upload video ‚Üí</span>
          </div>

          <div className="flex items-start justify-between mb-4 relative z-10">
            <div className="flex-1 min-w-0">
              <div
                className={`text-base font-semibold truncate transition-colors group-hover:text-primary ${
                  isDark ? 'text-gray-100' : 'text-gray-900'
                }`}
              >
                {project.name}
              </div>
              <div className={`text-sm mt-1 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                {project.videos} {t.videos}
              </div>
            </div>
            <span className={`px-2 py-1 rounded-lg text-xs font-medium ${
              project.status === 'active'
                ? 'bg-success/10 text-success'
                : isDark ? 'bg-gray-700 text-gray-400' : 'bg-gray-200 text-gray-600'
            }`}>
              {project.status === 'active' ? t.active : t.paused}
            </span>
          </div>

          <div className="flex items-center justify-between relative z-10">
            <div className="flex gap-2">
              {project.platforms.map((platform) => (
                <div
                  key={platform}
                  className={`w-8 h-8 rounded-lg flex items-center justify-center ${
                    isDark ? 'bg-background-700 text-gray-400' : 'bg-gray-100 text-gray-600'
                  }`}
                >
                  {getPlatformIcon(platform)}
                </div>
              ))}
            </div>
            <div className={`text-xs ${isDark ? 'text-gray-600' : 'text-gray-500'}`}>
              {t.lastActive}: {project.lastActive}
            </div>
          </div>
        </div>
      );
    }

    function TaskCard({ task, status, onMove }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);
      const priorityColors = {
        high: 'bg-error/10 text-error',
        medium: 'bg-warning/10 text-warning',
        low: isDark ? 'bg-gray-700 text-gray-400' : 'bg-gray-200 text-gray-600',
      };

      const columns = ['todo', 'inProgress', 'done'];
      const currentIndex = columns.indexOf(status);

      return (
        <div
          className={`border rounded-xl p-4 transition-smooth hover:border-gray-600 ${
            isDark
              ? 'bg-background-700 border-surface-border'
              : 'bg-gray-50 border-light-border hover:border-gray-300'
          }`}
        >
          <div className="flex items-start justify-between mb-3">
            <div className={`text-sm font-medium ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
              {task.title}
            </div>
            <span className={`px-2 py-0.5 rounded text-xs font-medium ${priorityColors[task.priority]}`}>
              {task.priority}
            </span>
          </div>
          <div className={`text-xs mb-3 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>{task.project}</div>
          {task.progress !== undefined && (
            <div className={`h-1.5 rounded-full overflow-hidden ${isDark ? 'bg-background-900' : 'bg-gray-200'}`}>
              <div
                className="h-full bg-primary rounded-full transition-all duration-500"
                style={{ width: `${task.progress}%` }}
              />
            </div>
          )}

          {/* Move buttons */}
          <div className="flex gap-2 mt-3 pt-3 border-t border-gray-700/30">
            {currentIndex > 0 && (
              <button
                onClick={() => onMove(columns[currentIndex - 1])}
                className={`px-2 py-1 rounded text-xs font-medium transition-smooth ${
                  isDark
                    ? 'bg-background-900 text-gray-400 hover:text-gray-200 hover:bg-gray-700'
                    : 'bg-gray-200 text-gray-600 hover:text-gray-900 hover:bg-gray-300'
                }`}
              >
                ‚Üê Back
              </button>
            )}
            {currentIndex < columns.length - 1 && (
              <button
                onClick={() => onMove(columns[currentIndex + 1])}
                className="px-2 py-1 rounded text-xs font-medium bg-primary/20 text-primary hover:bg-primary/30 transition-smooth ml-auto"
              >
                Next ‚Üí
              </button>
            )}
          </div>
        </div>
      );
    }

    function SchedulerBoard() {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);

      return (
        <div className="grid grid-cols-3 gap-6">
          {[
            { key: 'todo', title: t.todo, tasks: scheduleData.todo },
            { key: 'inProgress', title: t.inProgress, tasks: scheduleData.inProgress },
            { key: 'done', title: t.done, tasks: scheduleData.done },
          ].map((column) => (
            <div
              key={column.key}
              className={`border rounded-2xl p-4 ${
                isDark
                  ? 'bg-background-800 border-surface-border'
                  : 'bg-gray-50 border-light-border'
              }`}
            >
              <div className="flex items-center justify-between mb-4">
                <div className={`text-sm font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                  {column.title}
                </div>
                <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs ${
                  isDark ? 'bg-background-700 text-gray-500' : 'bg-white text-gray-600 shadow-sm'
                }`}>
                  {column.tasks.length}
                </div>
              </div>
              <div className="space-y-3">
                {column.tasks.map((task) => (
                  <TaskCard key={task.id} task={task} status={column.key} />
                ))}
              </div>
            </div>
          ))}
        </div>
      );
    }

    // ====== THEME HOOK ======
    const ThemeContext = React.createContext();

    function useTheme() {
      const context = React.useContext(ThemeContext);
      return context;
    }

    // ====== LAYOUT COMPONENTS ======
    function Sidebar({ currentPage, setCurrentPage, profiles, onConnectAccount, onShowToast }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);
      const [collapsed, setCollapsed] = useState(false);

      const navItems = [
        { id: 'dashboard', icon: <Icons.Dashboard />, label: t.navDashboard },
        { id: 'projects', icon: <Icons.Projects />, label: t.navProjects, disabled: true, disabledMessage: lang === 'ru' ? '–†–∞–∑–¥–µ–ª "–ü—Ä–æ–µ–∫—Ç—ã" –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —ç—Ç–∞–ø–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏' : 'Projects section will be available in future updates' },
        { id: 'scheduler', icon: <Icons.Scheduler />, label: t.navScheduler },
        { id: 'uploads', icon: <Icons.Uploads />, label: t.navUploads },
        { id: 'analytics', icon: <Icons.Analytics />, label: t.navAnalytics, disabled: true, disabledMessage: lang === 'ru' ? '–†–∞–∑–¥–µ–ª "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞" –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —ç—Ç–∞–ø–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏' : 'Analytics section will be available in future updates' },
        { id: 'settings', icon: <Icons.Settings />, label: t.navSettings },
      ];

      const profileCount = Object.keys(profiles).length;
      const primaryProfile = profiles.tiktok || profiles.youtube;

      const getPlatformIcon = (platform) => {
        switch (platform) {
          case 'tiktok': return <Icons.TikTok />;
          case 'youtube': return <Icons.YouTube />;
          default: return null;
        }
      };

      return (
        <aside
          className={`fixed left-0 top-0 h-full border transition-all duration-300 z-40 ${
            collapsed ? 'w-20' : 'w-64'
          } ${
            isDark
              ? 'bg-background-800 border-surface-border'
              : 'bg-white border-light-border shadow-lg'
          }`}
        >
          {/* Logo */}
          <div className={`h-16 flex items-center justify-between px-6 border-b ${isDark ? 'border-surface-border' : 'border-light-border'}`}>
            {!collapsed && (
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-primary to-primary-600 flex items-center justify-center">
                  <span className="text-white font-bold text-sm">RF</span>
                </div>
                <span className={`text-lg font-bold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                  ReelFlow
                </span>
              </div>
            )}
            <button
              onClick={() => setCollapsed(!collapsed)}
              className={`p-1.5 rounded-lg transition-smooth ${
                isDark
                  ? 'hover:bg-background-700 text-gray-400 hover:text-gray-200'
                  : 'hover:bg-gray-100 text-gray-600 hover:text-gray-900'
              }`}
            >
              <Icons.ChevronDown />
            </button>
          </div>

          {/* Navigation */}
          <nav className="p-4 space-y-1">
            {navItems.map((item) => (
              <button
                key={item.id}
                onClick={() => {
                  if (item.disabled) {
                    onShowToast(item.disabledMessage);
                    return;
                  }
                  setCurrentPage(item.id);
                }}
                className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-smooth relative ${
                  currentPage === item.id && !item.disabled
                    ? 'bg-primary text-white font-medium'
                    : isDark
                      ? 'text-gray-400 hover:text-gray-200 hover:bg-background-700'
                      : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                } ${item.disabled ? 'cursor-not-allowed opacity-70 hover:opacity-80' : ''}`}
                style={item.disabled ? {
                  backgroundImage: 'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,200,0,0.1) 5px, rgba(255,200,0,0.1) 10px)',
                } : undefined}
                title={item.disabled ? item.disabledMessage : undefined}
              >
                {item.icon}
                {!collapsed && <span className="flex-1 text-left">{item.label}</span>}
                {!collapsed && item.disabled && (
                  <span className="text-yellow-500 text-xs font-semibold uppercase tracking-wider">
                    {lang === 'ru' ? '–°–∫–æ—Ä–æ' : 'Soon'}
                  </span>
                )}
                {item.disabled && (
                  <div className="absolute inset-0 border-2 border-dashed border-yellow-500/30 rounded-xl pointer-events-none" />
                )}
              </button>
            ))}
          </nav>

          {/* User section */}
          <div className={`absolute bottom-0 left-0 right-0 p-4 border-t ${isDark ? 'border-surface-border' : 'border-light-border'}`}>
            {!collapsed ? (
              <div className="space-y-3">
                {/* Connected profiles */}
                {profileCount > 0 && (
                  <div className="flex gap-1">
                    {profiles.tiktok && (
                      <div className="w-8 h-8 rounded-lg bg-black text-white flex items-center justify-center" title="TikTok connected">
                        <Icons.TikTok />
                      </div>
                    )}
                    {profiles.youtube && (
                      <div className="w-8 h-8 rounded-lg bg-red-600 text-white flex items-center justify-center" title="YouTube connected">
                        <Icons.YouTube />
                      </div>
                    )}
                    {profileCount < 2 && (
                      <button
                        onClick={onConnectAccount}
                        className="w-8 h-8 rounded-lg border border-dashed border-gray-600 flex items-center justify-center text-gray-500 hover:border-gray-500 hover:text-gray-400 transition-smooth"
                        title="Connect more accounts"
                      >
                        +
                      </button>
                    )}
                  </div>
                )}

                {/* Primary profile info */}
                {primaryProfile ? (
                  <div className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                    {primaryProfile.display_name || primaryProfile.title}
                  </div>
                ) : (
                  <button
                    onClick={onConnectAccount}
                    className="w-full px-3 py-2 rounded-xl bg-primary text-white text-sm font-medium hover:bg-primary-600 transition-smooth"
                  >
                    Connect Account
                  </button>
                )}
              </div>
            ) : (
              <div className="flex justify-center">
                {profileCount > 0 ? (
                  <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-accent to-accent-600 flex items-center justify-center text-white">
                    {primaryProfile?.display_name?.substring(0, 2).toUpperCase() || primaryProfile?.title?.substring(0, 2).toUpperCase() || 'JD'}
                  </div>
                ) : (
                  <button
                    onClick={onConnectAccount}
                    className="w-10 h-10 rounded-xl bg-primary text-white flex items-center justify-center"
                  >
                    +
                  </button>
                )}
              </div>
            )}
          </div>
        </aside>
      );
    }

    function Header() {
      const { lang, setLang } = React.useContext(TranslationContext);
      const { isDark, toggleTheme } = React.useContext(ThemeContext);
      const t = translations[lang];
      const [searchQuery, setSearchQuery] = useState('');

      return (
        <header
          className={`h-16 border sticky top-0 z-30 transition-colors ${
            isDark
              ? 'bg-background-800/50 backdrop-blur-xl border-surface-border'
              : 'bg-white/80 backdrop-blur-xl border-light-border shadow-sm'
          }`}
        >
          <div className="h-full flex items-center justify-between px-6">
            {/* Search */}
            <div className="flex-1 max-w-md relative">
              <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                <Icons.Search />
              </div>
              <input
                type="text"
                placeholder={t.searchPlaceholder}
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className={`w-full pl-10 pr-4 py-2.5 rounded-xl text-sm transition-smooth focus:outline-none focus:border-primary ${
                  isDark
                    ? 'bg-background-900 border-surface-border text-gray-200 placeholder-gray-500'
                    : 'bg-gray-100 border-gray-200 text-gray-900 placeholder-gray-500'
                }`}
              />
            </div>

            {/* Right side */}
            <div className="flex items-center gap-3">
              {/* Theme Toggle */}
              <button
                onClick={toggleTheme}
                className={`p-2.5 rounded-xl border transition-smooth ${
                  isDark
                    ? 'bg-background-900 border-surface-border text-gray-400 hover:text-gray-200 hover:border-gray-600'
                    : 'bg-gray-100 border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300'
                }`}
                title={isDark ? 'Switch to Light Mode' : 'Switch to Dark Mode'}
              >
                {isDark ? <Icons.Sun /> : <Icons.Moon />}
              </button>

              {/* Language Switcher */}
              <button
                onClick={() => setLang(lang === 'en' ? 'ru' : 'en')}
                className={`px-3 py-2 rounded-xl border transition-smooth flex items-center gap-2 ${
                  isDark
                    ? 'bg-background-900 border-surface-border text-gray-400 hover:text-gray-200 hover:border-gray-600'
                    : 'bg-gray-100 border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300'
                }`}
              >
                <span className="text-base">üåê</span>
                <span className="text-sm font-medium">{lang === 'en' ? 'EN' : 'RU'}</span>
              </button>

              {/* Notifications */}
              <button
                className={`relative p-2.5 rounded-xl border transition-smooth ${
                  isDark
                    ? 'bg-background-900 border-surface-border text-gray-400 hover:text-gray-200 hover:border-gray-600'
                    : 'bg-gray-100 border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300'
                }`}
              >
                <Icons.Bell />
                <span className="absolute top-1 right-1 w-2 h-2 rounded-full bg-accent status-active" />
              </button>
            </div>
          </div>
        </header>
      );
    }

    // ====== PAGES ======
    function DashboardPage({ onUpload, setCurrentPage, profiles, activities, stats }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);

      // Check if user has connected at least one account
      const hasConnectedAccount = profiles && (profiles.tiktok || profiles.youtube);
      const profileCount = profiles ? Object.keys(profiles).length : 0;

      // Use stats from App for authorized users
      const currentKpiData = hasConnectedAccount ? stats : kpiData;

      // Calculate chart data from activities (last 7 days)
      const calculateChartData = () => {
        const now = new Date();
        const chartData = [];

        for (let i = 6; i >= 0; i--) {
          const date = new Date(now);
          date.setDate(date.getDate() - i);
          const dateStr = date.toISOString().split('T')[0];

          // Count activities for this day
          const count = activities.filter(a => {
            const activityDate = new Date(a.id);
            const activityDateStr = activityDate.toISOString().split('T')[0];
            return activityDateStr === dateStr;
          }).length;

          chartData.push(count);
        }

        return chartData;
      };

      const chartData = calculateChartData();

      // Calculate platform distribution from activities
      const calculatePlatformDistribution = () => {
        const distribution = {};
        activities.forEach(activity => {
          const platform = activity.platform || 'Unknown';
          distribution[platform] = (distribution[platform] || 0) + 1;
        });

        const total = activities.length;
        if (total === 0) return [];

        return Object.entries(distribution).map(([name, count]) => ({
          name,
          percentage: Math.round((count / total) * 100),
          color: name === 'TikTok' ? 'bg-primary' : name === 'YouTube' ? 'bg-error' : 'bg-accent'
        }));
      };

      const platformData = calculatePlatformDistribution();

      return (
        <div className="space-y-6 animate-fade-in">
          {/* KPI Cards */}
          <div className="grid grid-cols-4 gap-6">
            {hasConnectedAccount ? (
              <>
                <KPICard
                  title={t.kpiUploaded}
                  value={currentKpiData.uploaded.value}
                  change={currentKpiData.uploaded.change}
                  trend={currentKpiData.uploaded.trend}
                  delay={0}
                />
                <KPICard
                  title={t.kpiScheduled}
                  value={currentKpiData.scheduled.value}
                  change={currentKpiData.scheduled.change}
                  trend={currentKpiData.scheduled.trend}
                  delay={100}
                />
                <KPICard
                  title={t.kpiPublished}
                  value={currentKpiData.published.value}
                  change={currentKpiData.published.change}
                  trend={currentKpiData.published.trend}
                  delay={200}
                />
                <KPICard
                  title={t.kpiErrors}
                  value={currentKpiData.errors.value}
                  change={currentKpiData.errors.change}
                  trend={currentKpiData.errors.trend}
                  delay={300}
                />
              </>
            ) : (
              <div className="col-span-4">
                <div className={`border-2 border-dashed rounded-2xl p-12 text-center ${
                  isDark ? 'border-gray-700 bg-surface/50' : 'border-gray-300 bg-gray-50'
                }`}>
                  <div className="text-5xl mb-4">üîó</div>
                  <h3 className={`text-xl font-semibold mb-2 ${isDark ? 'text-gray-200' : 'text-gray-800'}`}>
                    {lang === 'ru' ? '–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç' : 'Connect an Account'}
                  </h3>
                  <p className={`text-sm mb-6 max-w-md mx-auto ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                    {lang === 'ru'
                      ? '–ü–æ–¥–∫–ª—é—á–∏—Ç–µ TikTok –∏–ª–∏ YouTube —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∞—à—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –Ω–∞—á–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞'
                      : 'Connect TikTok or YouTube to see your statistics and start publishing content'}
                  </p>
                  <button
                    onClick={() => setCurrentPage('settings')}
                    className="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-primary text-white font-medium hover:bg-primary-600 transition-smooth"
                  >
                    <Icons.Settings />
                    <span>{lang === 'ru' ? '–ü–µ—Ä–µ–π—Ç–∏ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º' : 'Go to Settings'}</span>
                  </button>
                </div>
              </div>
            )}
          </div>

          {/* Charts - only show when authorized */}
          {hasConnectedAccount && (
            <div className="grid grid-cols-3 gap-6">
              <div className="col-span-2">
                <ActivityChart data={chartData} />
              </div>
              <div>
                <PlatformDistribution platforms={platformData} />
              </div>
            </div>
          )}

          {/* Recent Activity & Quick Actions - only when authorized */}
          {hasConnectedAccount && (
            <div className="grid grid-cols-3 gap-6">
              <div className="col-span-2">
                <RecentActivity profiles={profiles} activities={activities} />
              </div>
              <div className={`border rounded-2xl p-6 ${isDark ? 'bg-surface border-surface-border' : 'bg-white border-light-border'}`}>
                <div className={`text-lg font-semibold mb-4 ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                  {t.quickActions}
                </div>
                <div className="space-y-3">
                  <button onClick={onUpload} className="w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-primary text-white font-medium hover:bg-primary-600 transition-smooth">
                    <Icons.Plus />
                    <span>{t.addNew}</span>
                  </button>
                  <button
                    onClick={() => setCurrentPage('uploads')}
                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-smooth ${
                      isDark
                        ? 'bg-background-700 text-gray-200 hover:bg-background-600'
                        : 'bg-gray-100 text-gray-900 hover:bg-gray-200'
                    }`}
                  >
                    <Icons.Uploads />
                    <span>{t.navUploads}</span>
                  </button>
                  <button
                    onClick={() => setCurrentPage('scheduler')}
                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-smooth ${
                      isDark
                        ? 'bg-background-700 text-gray-200 hover:bg-background-600'
                        : 'bg-gray-100 text-gray-900 hover:bg-gray-200'
                    }`}
                  >
                    <Icons.Scheduler />
                    <span>{t.navScheduler}</span>
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Quick Actions - show when not authorized */}
          {!hasConnectedAccount && (
            <div className={`border rounded-2xl p-6 ${isDark ? 'bg-surface border-surface-border' : 'bg-white border-light-border'}`}>
              <div className={`text-lg font-semibold mb-4 ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                {t.quickActions}
              </div>
              <div className="grid grid-cols-3 gap-3">
                <button onClick={onUpload} className="flex items-center justify-center gap-3 px-4 py-3 rounded-xl bg-primary text-white font-medium hover:bg-primary-600 transition-smooth">
                  <Icons.Plus />
                  <span>{t.addNew}</span>
                </button>
                <button
                  onClick={() => setCurrentPage('uploads')}
                  className={`flex items-center justify-center gap-3 px-4 py-3 rounded-xl font-medium transition-smooth ${
                    isDark
                      ? 'bg-background-700 text-gray-200 hover:bg-background-600'
                      : 'bg-gray-100 text-gray-900 hover:bg-gray-200'
                  }`}
                >
                  <Icons.Uploads />
                  <span>{t.navUploads}</span>
                </button>
                <button
                  onClick={() => setCurrentPage('scheduler')}
                  className={`flex items-center justify-center gap-3 px-4 py-3 rounded-xl font-medium transition-smooth ${
                    isDark
                      ? 'bg-background-700 text-gray-200 hover:bg-background-600'
                      : 'bg-gray-100 text-gray-900 hover:bg-gray-200'
                  }`}
                >
                  <Icons.Scheduler />
                  <span>{t.navScheduler}</span>
                </button>
              </div>
            </div>
          )}
        </div>
      );
    }

    function ProjectsPage({ onUpload }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);
      const [projects, setProjects] = useState(projectsData);
      const [showCreateModal, setShowCreateModal] = useState(false);
      const [newProjectName, setNewProjectName] = useState('');
      const [newProjectPlatforms, setNewProjectPlatforms] = useState(['tiktok']);

      const handleCreateProject = async () => {
        if (!newProjectName.trim()) return;

        try {
          const result = await apiRequest('/api/projects', {
            method: 'POST',
            body: JSON.stringify({
              name: newProjectName,
              platforms: newProjectPlatforms,
            }),
          });

          setProjects([...projects, result.project]);
          setNewProjectName('');
          setNewProjectPlatforms(['tiktok']);
          setShowCreateModal(false);
        } catch (e) {
          console.error('Failed to create project:', e);
        }
      };

      const togglePlatform = (platform) => {
        if (newProjectPlatforms.includes(platform)) {
          setNewProjectPlatforms(newProjectPlatforms.filter(p => p !== platform));
        } else {
          setNewProjectPlatforms([...newProjectPlatforms, platform]);
        }
      };

      return (
        <div className="space-y-6 animate-fade-in">
          <div className="flex items-center justify-between">
            <div>
              <h1 className={`text-2xl font-bold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>{t.projectsTitle}</h1>
              <p className={`text-sm ${isDark ? 'text-gray-500' : 'text-gray-600'} mt-1`}>
                Manage your content projects and connected channels
              </p>
            </div>
            <button
              onClick={() => setShowCreateModal(true)}
              className="flex items-center gap-2 px-5 py-2.5 rounded-xl bg-primary text-white font-medium hover:bg-primary-600 transition-smooth"
            >
              <Icons.Plus />
              <span>{t.createProject}</span>
            </button>
          </div>

          <div className="grid grid-cols-2 gap-6">
            {projects.map((project) => (
              <ProjectCard
                key={project.id}
                project={project}
                onClick={() => onUpload(project.id)}
              />
            ))}
          </div>

          {/* Create Project Modal */}
          {showCreateModal && (
            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in">
              <div className={`w-full max-w-md rounded-2xl p-6 ${isDark ? 'bg-surface border border-surface-border' : 'bg-white border border-gray-200'} animate-slide-up`}>
                <div className="flex items-center justify-between mb-6">
                  <h2 className={`text-xl font-bold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                    {t.createProject}
                  </h2>
                  <button onClick={() => setShowCreateModal(false)} className={`p-2 rounded-lg ${isDark ? 'hover:bg-background-700 text-gray-400' : 'hover:bg-gray-100 text-gray-600'}`}>
                    ‚úï
                  </button>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                      Project Name
                    </label>
                    <input
                      type="text"
                      value={newProjectName}
                      onChange={(e) => setNewProjectName(e.target.value)}
                      placeholder="My Awesome Channel"
                      className={`w-full px-4 py-3 rounded-xl text-sm transition-smooth focus:outline-none focus:border-primary ${
                        isDark
                          ? 'bg-background-900 border-surface-border text-gray-200 placeholder-gray-500'
                          : 'bg-gray-100 border-gray-200 text-gray-900 placeholder-gray-500'
                      }`}
                    />
                  </div>

                  <div>
                    <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                      Platforms
                    </label>
                    <div className="flex gap-2">
                      {['tiktok', 'instagram', 'youtube'].map((platform) => (
                        <button
                          key={platform}
                          onClick={() => togglePlatform(platform)}
                          className={`px-4 py-2 rounded-lg text-sm font-medium capitalize transition-smooth ${
                            newProjectPlatforms.includes(platform)
                              ? 'bg-primary text-white'
                              : isDark
                                ? 'bg-background-700 text-gray-400 hover:bg-background-600'
                                : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                          }`}
                        >
                          {platform}
                        </button>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-3">
                    <button
                      onClick={() => setShowCreateModal(false)}
                      className={`flex-1 px-5 py-3 rounded-xl font-medium transition-smooth ${
                        isDark
                          ? 'bg-background-700 text-gray-200 hover:bg-background-600'
                          : 'bg-gray-200 text-gray-900 hover:bg-gray-300'
                      }`}
                    >
                      Cancel
                    </button>
                    <button
                      onClick={handleCreateProject}
                      disabled={!newProjectName.trim()}
                      className="flex-1 px-5 py-3 rounded-xl bg-primary text-white font-medium hover:bg-primary-600 transition-smooth disabled:opacity-50"
                    >
                      Create
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function SchedulerPage() {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);

      // Local state for draggable tasks
      const [tasks, setTasks] = useState(scheduleData);

      const moveTask = (taskId, fromColumn, toColumn) => {
        const task = tasks[fromColumn].find(t => t.id === taskId);
        if (!task) return;

        const newTasks = { ...tasks };
        newTasks[fromColumn] = newTasks[fromColumn].filter(t => t.id !== taskId);
        newTasks[toColumn] = [...newTasks[toColumn], { ...task, progress: undefined }];
        setTasks(newTasks);
      };

      return (
        <div className="space-y-6 animate-fade-in">
          <div className="flex items-center justify-between">
            <div>
              <h1 className={`text-2xl font-bold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>{t.schedulerTitle}</h1>
              <p className={`text-sm ${isDark ? 'text-gray-500' : 'text-gray-600'} mt-1`}>
                Track and manage your content workflow
              </p>
            </div>
            <button
              onClick={() => {
                const title = prompt('Enter task title:');
                if (title) {
                  const newTask = {
                    id: Date.now(),
                    title,
                    project: 'General',
                    priority: 'medium',
                  };
                  setTasks({ ...tasks, todo: [...tasks.todo, newTask] });
                }
              }}
              className="flex items-center gap-2 px-5 py-2.5 rounded-xl bg-primary text-white font-medium hover:bg-primary-600 transition-smooth"
            >
              <Icons.Plus />
              <span>{t.addNew}</span>
            </button>
          </div>

          <div className="grid grid-cols-3 gap-6">
            {[
              { key: 'todo', title: t.todo, tasks: tasks.todo },
              { key: 'inProgress', title: t.inProgress, tasks: tasks.inProgress },
              { key: 'done', title: t.done, tasks: tasks.done },
            ].map((column) => (
              <div
                key={column.key}
                className={`border rounded-2xl p-4 ${
                  isDark
                    ? 'bg-background-800 border-surface-border'
                    : 'bg-gray-50 border-light-border'
                }`}
              >
                <div className="flex items-center justify-between mb-4">
                  <div className={`text-sm font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    {column.title}
                  </div>
                  <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs ${
                    isDark ? 'bg-background-700 text-gray-500' : 'bg-white text-gray-600 shadow-sm'
                  }`}>
                    {column.tasks.length}
                  </div>
                </div>
                <div className="space-y-3">
                  {column.tasks.map((task) => (
                    <TaskCard
                      key={task.id}
                      task={task}
                      status={column.key}
                      onMove={(toColumn) => moveTask(task.id, column.key, toColumn)}
                    />
                  ))}
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // ====== TRANSLATION HOOK ======
    const TranslationContext = React.createContext();

    function useTranslations() {
      const context = React.useContext(TranslationContext);
      return context;
    }

    // ====== MODAL COMPONENTS ======
    function AuthModal({ isOpen, onClose, onSuccess }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);
      const [code, setCode] = useState('');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const [platform, setPlatform] = useState('tiktok'); // 'tiktok' or 'youtube'

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º sessionStorage –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      React.useEffect(() => {
        if (!isOpen) return;

        console.log('[Auth] Checking sessionStorage for OAuth callback...');
        const checkStorage = () => {
          const oauthData = sessionStorage.getItem('oauth_callback');
          if (oauthData) {
            try {
              const data = JSON.parse(oauthData);
              console.log('[Auth] Found OAuth data in storage:', data);

              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å—Ç–∞—Ä—ã–µ (5 –º–∏–Ω—É—Ç)
              if (Date.now() - data.timestamp < 5 * 60 * 1000) {
                console.log('[Auth] Processing OAuth code from storage...');
                sessionStorage.removeItem('oauth_callback'); // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                handleExchange(data.code);
              } else {
                console.log('[Auth] OAuth data expired, removing...');
                sessionStorage.removeItem('oauth_callback');
              }
            } catch (e) {
              console.error('[Auth] Failed to parse OAuth data:', e);
              sessionStorage.removeItem('oauth_callback');
            }
          }
        };

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É
        checkStorage();

        // –ò –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ popup –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É)
        const interval = setInterval(checkStorage, 1000);

        // –¢–∞–∫–∂–µ —Å–ª—É—à–∞–µ–º postMessage –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        const messageHandler = async (event) => {
          console.log('[Auth] Received message:', event.data);
          if (event.data.type === 'oauth_code') {
            console.log('[Auth] Got OAuth code via postMessage:', event.data.code?.substring(0, 20) + '...');
            clearInterval(interval);
            setCode(event.data.code);
            await handleExchange(event.data.code);
          }
        };
        window.addEventListener('message', messageHandler);

        return () => {
          clearInterval(interval);
          window.removeEventListener('message', messageHandler);
        };
      }, [isOpen]);

      if (!isOpen) return null;

      const handleAuth = () => {
        console.log('[Auth] Starting OAuth flow for:', platform);
        const result = openPlatformAuth(platform);
        console.log('[Auth] Popup opened:', result);
      };

      const handleExchange = async (authCode) => {
        setLoading(true);
        setError('');
        try {
          const result = await exchangePlatformCode(platform, authCode);
          if (result.ok) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º session ID
            if (result.sid) {
              saveSessionId(result.sid);
            }
            onSuccess(result.profile);
            onClose();
          } else {
            setError(result.profile_error?.body || 'Auth failed');
          }
        } catch (e) {
          setError(e.message);
        } finally {
          setLoading(false);
        }
      };

      const handleManualCode = async () => {
        if (!code.trim()) return;
        await handleExchange(code.trim());
      };

      return (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in">
          <div className={`w-full max-w-md rounded-2xl p-6 ${isDark ? 'bg-surface border border-surface-border' : 'bg-white border border-gray-200'} animate-slide-up`}>
            <div className="flex items-center justify-between mb-6">
              <h2 className={`text-xl font-bold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                Connect Account
              </h2>
              <button onClick={onClose} className={`p-2 rounded-lg ${isDark ? 'hover:bg-background-700 text-gray-400' : 'hover:bg-gray-100 text-gray-600'}`}>
                ‚úï
              </button>
            </div>

            <div className="space-y-4">
              {/* Platform selector */}
              <div className="flex gap-2">
                <button
                  onClick={() => setPlatform('tiktok')}
                  className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium transition-smooth ${
                    platform === 'tiktok'
                      ? 'bg-black text-white'
                      : isDark ? 'bg-background-700 text-gray-400 hover:bg-background-600' : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                  }`}
                >
                  <Icons.TikTok />
                  <span>TikTok</span>
                </button>
                <button
                  onClick={() => setPlatform('youtube')}
                  className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium transition-smooth ${
                    platform === 'youtube'
                      ? 'bg-red-600 text-white'
                      : isDark ? 'bg-background-700 text-gray-400 hover:bg-background-600' : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                  }`}
                >
                  <Icons.YouTube />
                  <span>YouTube</span>
                </button>
              </div>

              <button
                onClick={handleAuth}
                disabled={loading}
                className={`w-full flex items-center justify-center gap-3 px-5 py-3 rounded-xl text-white font-medium transition-smooth disabled:opacity-50 ${
                  platform === 'tiktok' ? 'bg-black hover:bg-gray-800' : 'bg-red-600 hover:bg-red-700'
                }`}
              >
                {platform === 'tiktok' ? <Icons.TikTok /> : <Icons.YouTube />}
                <span>{loading ? 'Loading...' : `Connect with ${platform === 'tiktok' ? 'TikTok' : 'YouTube'}`}</span>
              </button>

              <div className={`text-center text-sm ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>
                or paste authorization code
              </div>

              <textarea
                value={code}
                onChange={(e) => setCode(e.target.value)}
                placeholder={`Paste authorization code from ${platform === 'tiktok' ? 'TikTok' : 'YouTube'}...`}
                className={`w-full px-4 py-3 rounded-xl text-sm resize-none transition-smooth focus:outline-none focus:border-primary ${
                  isDark
                    ? 'bg-background-900 border-surface-border text-gray-200 placeholder-gray-500'
                    : 'bg-gray-100 border-gray-200 text-gray-900 placeholder-gray-500'
                }`}
                rows={3}
              />

              <button
                onClick={handleManualCode}
                disabled={loading || !code.trim()}
                className="w-full px-5 py-3 rounded-xl bg-primary text-white font-medium hover:bg-primary-600 transition-smooth disabled:opacity-50"
              >
                Connect with Code
              </button>

              {error && (
                <div className={`p-3 rounded-xl text-sm break-words ${isDark ? 'bg-error/10 text-error' : 'bg-red-50 text-red-600'}`}>
                  {error}
                </div>
              )}

              <div className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>
                <strong>Note:</strong> You need to set your{' '}
                {platform === 'tiktok' ? 'TikTok Client Key' : 'Google Client ID'} in the code.
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Legacy TikTok-only modal
    function TikTokAuthModal({ isOpen, onClose, onSuccess }) {
      return <AuthModal isOpen={isOpen} onClose={onClose} onSuccess={onSuccess} />;
    }

    function UploadModal({ isOpen, onClose, projectId, onUploadSuccess }) {
      const { lang } = React.useContext(TranslationContext);
      const t = translations[lang];
      const { isDark } = React.useContext(ThemeContext);
      const [step, setStep] = useState(1); // 1: Video, 2: Details, 3: Schedule, 4: Review
      const [file, setFile] = useState(null);
      const [videoPreview, setVideoPreview] = useState(null);

      // Thumbnail
      const [thumbnail, setThumbnail] = useState(null);
      const [thumbnailPreview, setThumbnailPreview] = useState(null);

      // Video details
      const [title, setTitle] = useState('');
      const [description, setDescription] = useState('');
      const [hashtags, setHashtags] = useState('');
      const [privacy, setPrivacy] = useState('public'); // 'public', 'unlisted', 'private'

      // Platforms
      const [selectedPlatforms, setSelectedPlatforms] = useState(['tiktok']);
      const [profiles, setProfiles] = useState({});

      // Schedule
      const [scheduleType, setScheduleType] = useState('now'); // 'now' or 'later'
      const [scheduleDate, setScheduleDate] = useState('');
      const [scheduleTime, setScheduleTime] = useState('');

      // Upload state
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const [result, setResult] = useState(null);

      // Load profiles on mount
      React.useEffect(() => {
        const loadProfiles = async () => {
          try {
            const data = await apiRequest('/api/me');
            setProfiles(data.profiles || {});
          } catch (e) {
            console.log('Not logged in');
          }
        };
        loadProfiles();
      }, []);

      if (!isOpen) return null;

      const handleFileChange = (e) => {
        const selected = e.target.files?.[0];
        if (selected && selected.type.startsWith('video/')) {
          setFile(selected);
          setError('');

          // Create video preview
          const url = URL.createObjectURL(selected);
          setVideoPreview(url);

          // Auto-fill title from filename
          setTitle(selected.name.replace(/\.[^/.]+$/, ''));
        } else {
          setError('Please select a valid video file (MP4, MOV, WebM)');
        }
      };

      const handleThumbnailChange = (e) => {
        const selected = e.target.files?.[0];
        if (selected && selected.type.startsWith('image/')) {
          setThumbnail(selected);
          setError('');

          // Create thumbnail preview
          const url = URL.createObjectURL(selected);
          setThumbnailPreview(url);
        } else {
          setError('Please select a valid image file (JPG, PNG)');
        }
      };

      const togglePlatform = (platform) => {
        setSelectedPlatforms(prev =>
          prev.includes(platform)
            ? prev.filter(p => p !== platform)
            : [...prev, platform]
        );
      };

      const validateStep = () => {
        if (step === 1) {
          if (!file) {
            setError('Please select a video file');
            return false;
          }
        }
        if (step === 2) {
          if (!title.trim()) {
            setError('Please enter a video title');
            return false;
          }
          if (selectedPlatforms.length === 0) {
            setError('Please select at least one platform');
            return false;
          }
        }
        if (step === 3) {
          if (scheduleType === 'later' && (!scheduleDate || !scheduleTime)) {
            setError('Please select date and time for scheduled upload');
            return false;
          }
        }
        setError('');
        return true;
      };

      const handleNext = () => {
        if (validateStep()) {
          setStep(prev => prev + 1);
        }
      };

      const handleBack = () => {
        setStep(prev => prev - 1);
        setError('');
      };

      const handleUpload = async () => {
        if (!file || !validateStep()) return;

        setLoading(true);
        setError('');
        try {
          console.log('[Upload] Starting upload for:', file.name);

          // Upload video with timeout
          const uploadPromise = uploadVideo(file);
          const timeoutPromise = new Promise((_, reject) =>
            setTimeout(() => reject(new Error('Upload timeout - please try again')), 60000)
          );

          const res = await Promise.race([uploadPromise, timeoutPromise]);
          console.log('[Upload] Response:', res);

          if (res && res.publish_id) {
            // Calculate scheduled time
            let scheduledFor = null;
            if (scheduleType === 'later' && scheduleDate && scheduleTime) {
              scheduledFor = new Date(`${scheduleDate}T${scheduleTime}`).toISOString();
            }

            // Save video data (optional - may fail if backend doesn't have this endpoint)
            try {
              await apiRequest('/api/videos', {
                method: 'POST',
                body: JSON.stringify({
                  projectId,
                  videoName: file.name,
                  publishId: res.publish_id,
                  title,
                  description,
                  hashtags: hashtags.split(',').map(h => h.trim()).filter(h => h),
                  platforms: selectedPlatforms,
                  privacy,
                  scheduledFor,
                  status: scheduledFor ? 'scheduled' : 'uploaded',
                }),
              });
            } catch (saveError) {
              console.warn('[Upload] Failed to save video data:', saveError);
              // Continue anyway - upload was successful
            }

            setResult({
              ...res,
              title,
              platforms: selectedPlatforms,
              privacy,
              scheduledFor,
            });

            // Notify parent component of successful upload
            if (onUploadSuccess) {
              onUploadSuccess({
                platform: selectedPlatforms[0] || 'TikTok',
                videoName: title || file.name
              });
            }

            // Auto-close after 3 seconds
            setTimeout(() => {
              handleClose();
              onClose();
            }, 3000);
          } else {
            throw new Error('Invalid upload response - no publish_id');
          }
        } catch (e) {
          console.error('[Upload] Error:', e);

          // Parse TikTok API errors
          let errorMessage = e.message || 'Upload failed. Please try again.';

          // Check for specific TikTok errors
          if (e.message?.includes('spam_risk_too_many_pending_share')) {
            errorMessage = lang === 'ru'
              ? 'TikTok –æ–≥—Ä–∞–Ω–∏—á–∏–ª –∑–∞–≥—Ä—É–∑–∫—É: —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤–∏–¥–µ–æ –æ–∂–∏–¥–∞—é—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–∏. –û–ø—É–±–ª–∏–∫—É–π—Ç–µ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –≤–∏–¥–µ–æ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.'
              : 'TikTok upload limit reached: Too many videos pending publication. Please publish or delete old videos and try again.';
          } else if (e.message?.includes('spam_risk')) {
            errorMessage = lang === 'ru'
              ? 'TikTok –ø–æ–º–µ—Ç–∏–ª –∫–∞–∫ —Å–ø–∞–º. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–≥—Ä—É–∑–∫–æ–π.'
              : 'TikTok flagged as spam. Please wait a bit before uploading again.';
          } else if (e.message?.includes('401') || e.message?.includes('Unauthorized')) {
            errorMessage = lang === 'ru'
              ? '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç TikTok –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.'
              : 'Authorization error. Please reconnect your TikTok account in settings.';
          }

          setError(errorMessage);
        } finally {
          setLoading(false);
        }
      };

      const handleClose = () => {
        setStep(1);
        setFile(null);
        setVideoPreview(null);
        setThumbnail(null);
        setThumbnailPreview(null);
        setTitle('');
        setDescription('');
        setHashtags('');
        setPrivacy('public');
        setSelectedPlatforms(['tiktok']);
        setScheduleType('now');
        setScheduleDate('');
        setScheduleTime('');
        setError('');
        setResult(null);
        onClose();
      };

      const renderStep1 = () => (
        <div className="space-y-4">
          <h3 className={`text-lg font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
            Step 1: Select Video
          </h3>

          {!file ? (
            <label className={`block border-2 border-dashed rounded-xl p-12 text-center cursor-pointer transition-smooth ${
              isDark
                ? 'border-surface-border hover:border-gray-600 hover:bg-background-900'
                : 'border-gray-300 hover:border-gray-400 hover:bg-gray-50'
            }`}>
              <div className="text-6xl mb-4">üìπ</div>
              <div className={`text-lg font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                Drop your video here or click to browse
              </div>
              <div className={`text-sm ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>
                MP4, MOV, WebM supported ‚Ä¢ Max 500MB
              </div>
              <input
                type="file"
                accept="video/*"
                onChange={handleFileChange}
                className="hidden"
              />
            </label>
          ) : (
            <div className="space-y-3">
              <div className={`p-4 rounded-xl ${isDark ? 'bg-background-900' : 'bg-gray-50'}`}>
                <div className={`text-sm font-medium truncate mb-1 ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                  {file.name}
                </div>
                <div className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                  {(file.size / 1024 / 1024).toFixed(2)} MB ‚Ä¢ {file.type}
                </div>
              </div>

              {videoPreview && (
                <video
                  src={videoPreview}
                  controls
                  className="w-full rounded-xl"
                  style={{ maxHeight: '300px' }}
                />
              )}

              <button
                onClick={() => {
                  setFile(null);
                  setVideoPreview(null);
                }}
                className={`w-full px-4 py-2 rounded-lg text-sm font-medium transition-smooth ${
                  isDark
                    ? 'bg-error/10 text-error hover:bg-error/20'
                    : 'bg-red-50 text-red-600 hover:bg-red-100'
                }`}
              >
                Remove Video
              </button>
            </div>
          )}
        </div>
      );

      const renderStep2 = () => (
        <div className="space-y-4">
          <h3 className={`text-lg font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
            Step 2: Video Details
          </h3>

          {/* Title */}
          <div>
            <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
              Title <span className="text-error">*</span>
            </label>
            <input
              type="text"
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              placeholder="Enter video title..."
              maxLength={100}
              className={`w-full px-4 py-3 rounded-xl text-sm transition-smooth focus:outline-none focus:border-primary ${
                isDark
                  ? 'bg-background-900 border-surface-border text-gray-200 placeholder-gray-500'
                  : 'bg-gray-100 border-gray-200 text-gray-900 placeholder-gray-500'
              } border`}
            />
            <div className={`text-xs mt-1 ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>
              {title.length}/100 characters
            </div>
          </div>

          {/* Description */}
          <div>
            <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
              Description
            </label>
            <textarea
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              placeholder="Describe your video..."
              rows={4}
              maxLength={1000}
              className={`w-full px-4 py-3 rounded-xl text-sm resize-none transition-smooth focus:outline-none focus:border-primary ${
                isDark
                  ? 'bg-background-900 border-surface-border text-gray-200 placeholder-gray-500'
                  : 'bg-gray-100 border-gray-200 text-gray-900 placeholder-gray-500'
              } border`}
            />
            <div className={`text-xs mt-1 ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>
              {description.length}/1000 characters
            </div>
          </div>

          {/* Hashtags */}
          <div>
            <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
              Hashtags
            </label>
            <input
              type="text"
              value={hashtags}
              onChange={(e) => setHashtags(e.target.value)}
              placeholder="funny, viral, trending (comma separated)"
              className={`w-full px-4 py-3 rounded-xl text-sm transition-smooth focus:outline-none focus:border-primary ${
                isDark
                  ? 'bg-background-900 border-surface-border text-gray-200 placeholder-gray-500'
                  : 'bg-gray-100 border-gray-200 text-gray-900 placeholder-gray-500'
              } border`}
            />
          </div>

          {/* Privacy */}
          <div>
            <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
              Privacy <span className="text-error">*</span>
            </label>
            <div className="grid grid-cols-3 gap-2">
              <button
                onClick={() => setPrivacy('public')}
                className={`px-4 py-3 rounded-xl text-sm font-medium transition-smooth ${
                  privacy === 'public'
                    ? 'bg-primary text-white'
                    : isDark
                    ? 'bg-background-900 text-gray-300 hover:bg-background-800 border border-surface-border'
                    : 'bg-gray-100 text-gray-900 hover:bg-gray-200 border border-gray-200'
                }`}
              >
                <div className="text-xl mb-1">üåç</div>
                <div>Public</div>
                <div className={`text-xs mt-1 ${privacy === 'public' ? 'opacity-80' : 'opacity-60'}`}>
                  Everyone can see
                </div>
              </button>

              <button
                onClick={() => setPrivacy('unlisted')}
                className={`px-4 py-3 rounded-xl text-sm font-medium transition-smooth ${
                  privacy === 'unlisted'
                    ? 'bg-primary text-white'
                    : isDark
                    ? 'bg-background-900 text-gray-300 hover:bg-background-800 border border-surface-border'
                    : 'bg-gray-100 text-gray-900 hover:bg-gray-200 border border-gray-200'
                }`}
              >
                <div className="text-xl mb-1">üîó</div>
                <div>Unlisted</div>
                <div className={`text-xs mt-1 ${privacy === 'unlisted' ? 'opacity-80' : 'opacity-60'}`}>
                  Only with link
                </div>
              </button>

              <button
                onClick={() => setPrivacy('private')}
                className={`px-4 py-3 rounded-xl text-sm font-medium transition-smooth ${
                  privacy === 'private'
                    ? 'bg-primary text-white'
                    : isDark
                    ? 'bg-background-900 text-gray-300 hover:bg-background-800 border border-surface-border'
                    : 'bg-gray-100 text-gray-900 hover:bg-gray-200 border border-gray-200'
                }`}
              >
                <div className="text-xl mb-1">üîí</div>
                <div>Private</div>
                <div className={`text-xs mt-1 ${privacy === 'private' ? 'opacity-80' : 'opacity-60'}`}>
                  Only you
                </div>
              </button>
            </div>
          </div>

          {/* Thumbnail */}
          {selectedPlatforms.includes('youtube') && (
            <div>
              <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                Thumbnail (YouTube) <span className="text-xs text-gray-500 font-normal">- Optional</span>
              </label>
              {!thumbnail ? (
                <label className={`block border-2 border-dashed rounded-xl p-6 text-center cursor-pointer transition-smooth ${
                  isDark
                    ? 'border-surface-border hover:border-gray-600 hover:bg-background-900'
                    : 'border-gray-300 hover:border-gray-400 hover:bg-gray-50'
                }`}>
                  <div className="text-3xl mb-2">üñºÔ∏è</div>
                  <div className={`text-sm font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    Upload custom thumbnail
                  </div>
                  <div className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>
                    JPG or PNG ‚Ä¢ Min 1280x720 ‚Ä¢ Recommended 16:9
                  </div>
                  <input
                    type="file"
                    accept="image/jpeg,image/png"
                    onChange={handleThumbnailChange}
                    className="hidden"
                  />
                </label>
              ) : (
                <div className="space-y-3">
                  <div className={`p-3 rounded-xl ${isDark ? 'bg-background-900' : 'bg-gray-50'}`}>
                    <div className="flex items-center gap-3">
                      <img
                        src={thumbnailPreview}
                        alt="Thumbnail preview"
                        className="w-24 h-16 object-cover rounded-lg"
                      />
                      <div className="flex-1 min-w-0">
                        <div className={`text-sm font-medium truncate ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                          {thumbnail.name}
                        </div>
                        <div className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                          {(thumbnail.size / 1024).toFixed(1)} KB
                        </div>
                      </div>
                      <button
                        onClick={() => {
                          setThumbnail(null);
                          setThumbnailPreview(null);
                        }}
                        className={`p-2 rounded-lg ${isDark ? 'hover:bg-background-800 text-gray-400' : 'hover:bg-gray-200 text-gray-600'}`}
                      >
                        ‚úï
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Platforms */}
          <div>
            <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
              Platforms <span className="text-error">*</span>
            </label>
            <div className="grid grid-cols-2 gap-3">
              {/* TikTok */}
              <button
                onClick={() => togglePlatform('tiktok')}
                disabled={!profiles.tiktok}
                className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-smooth ${
                  selectedPlatforms.includes('tiktok')
                    ? 'bg-black text-white'
                    : profiles.tiktok
                    ? isDark
                      ? 'bg-background-900 border-2 border-transparent hover:border-gray-600'
                      : 'bg-gray-100 border-2 border-transparent hover:border-gray-300'
                    : 'opacity-50 cursor-not-only'
                } ${isDark ? 'text-gray-200' : 'text-gray-900'}`}
              >
                <Icons.TikTok />
                <div className="text-left">
                  <div className="text-sm font-medium">TikTok</div>
                  <div className="text-xs opacity-70">
                    {profiles.tiktok ? 'Connected' : 'Not connected'}
                  </div>
                </div>
                {selectedPlatforms.includes('tiktok') && (
                  <div className="ml-auto">
                    <Icons.Check />
                  </div>
                )}
              </button>

              {/* YouTube */}
              <button
                onClick={() => togglePlatform('youtube')}
                disabled={!profiles.youtube}
                className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-smooth ${
                  selectedPlatforms.includes('youtube')
                    ? 'bg-red-600 text-white'
                    : profiles.youtube
                    ? isDark
                      ? 'bg-background-900 border-2 border-transparent hover:border-gray-600'
                      : 'bg-gray-100 border-2 border-transparent hover:border-gray-300'
                    : 'opacity-50 cursor-not-allowed'
                } ${isDark ? 'text-gray-200' : 'text-gray-900'}`}
              >
                <Icons.YouTube />
                <div className="text-left">
                  <div className="text-sm font-medium">YouTube</div>
                  <div className="text-xs opacity-70">
                    {profiles.youtube ? 'Connected' : 'Not connected'}
                  </div>
                </div>
                {selectedPlatforms.includes('youtube') && (
                  <div className="ml-auto">
                    <Icons.Check />
                  </div>
                )}
              </button>
            </div>

            {!profiles.tiktok && !profiles.youtube && (
              <button
                onClick={() => {/* TODO: Open connect modal */}}
                className={`w-full mt-3 px-4 py-2 rounded-lg text-sm font-medium ${
                  isDark
                    ? 'bg-primary text-white hover:bg-primary-600'
                    : 'bg-primary text-white hover:bg-primary-600'
                }`}
              >
                Connect a Platform First
              </button>
            )}
          </div>
        </div>
      );

      const renderStep3 = () => (
        <div className="space-y-4">
          <h3 className={`text-lg font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
            Step 3: Schedule Upload
          </h3>

          <div className="grid grid-cols-2 gap-3">
            <button
              onClick={() => setScheduleType('now')}
              className={`px-4 py-4 rounded-xl transition-smooth ${
                scheduleType === 'now'
                  ? 'bg-primary text-white'
                  : isDark
                  ? 'bg-background-900 text-gray-300 hover:bg-background-800'
                  : 'bg-gray-100 text-gray-900 hover:bg-gray-200'
              }`}
            >
              <div className="text-2xl mb-2">‚ö°</div>
              <div className="text-sm font-medium">Upload Now</div>
              <div className={`text-xs mt-1 ${scheduleType === 'now' ? 'opacity-80' : 'opacity-60'}`}>
                Publish immediately
              </div>
            </button>

            <button
              onClick={() => setScheduleType('later')}
              className={`px-4 py-4 rounded-xl transition-smooth ${
                scheduleType === 'later'
                  ? 'bg-primary text-white'
                  : isDark
                  ? 'bg-background-900 text-gray-300 hover:bg-background-800'
                  : 'bg-gray-100 text-gray-900 hover:bg-gray-200'
              }`}
            >
              <div className="text-2xl mb-2">üìÖ</div>
              <div className="text-sm font-medium">Schedule</div>
              <div className={`text-xs mt-1 ${scheduleType === 'later' ? 'opacity-80' : 'opacity-60'}`}>
                Publish later
              </div>
            </button>
          </div>

          {scheduleType === 'later' && (
            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                  Date
                </label>
                <input
                  type="date"
                  value={scheduleDate}
                  onChange={(e) => setScheduleDate(e.target.value)}
                  min={new Date().toISOString().split('T')[0]}
                  className={`w-full px-4 py-3 rounded-xl text-sm transition-smooth focus:outline-none focus:border-primary ${
                    isDark
                      ? 'bg-background-900 border-surface-border text-gray-200'
                      : 'bg-gray-100 border-gray-200 text-gray-900'
                  } border`}
                />
              </div>
              <div>
                <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                  Time
                </label>
                <input
                  type="time"
                  value={scheduleTime}
                  onChange={(e) => setScheduleTime(e.target.value)}
                  className={`w-full px-4 py-3 rounded-xl text-sm transition-smooth focus:outline-none focus:border-primary ${
                    isDark
                      ? 'bg-background-900 border-surface-border text-gray-200'
                      : 'bg-gray-100 border-gray-200 text-gray-900'
                  } border`}
                />
              </div>
            </div>
          )}

          {scheduleType === 'later' && scheduleDate && scheduleTime && (
            <div className={`p-3 rounded-xl text-sm ${isDark ? 'bg-background-900' : 'bg-gray-100'}`}>
              <span className={isDark ? 'text-gray-400' : 'text-gray-600'}>
                Video will be published on:
              </span>
              <span className={`ml-2 font-medium ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                {new Date(`${scheduleDate}T${scheduleTime}`).toLocaleString()}
              </span>
            </div>
          )}
        </div>
      );

      const renderStep4 = () => (
        <div className="space-y-4">
          <h3 className={`text-lg font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
            Step 4: Review & Upload
          </h3>

          <div className={`p-4 rounded-xl space-y-3 ${isDark ? 'bg-background-900' : 'bg-gray-100'}`}>
            {/* Video */}
            <div>
              <div className={`text-xs font-medium mb-1 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                VIDEO
              </div>
              <div className={`text-sm ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                {file?.name}
              </div>
            </div>

            {/* Thumbnail */}
            {thumbnail && selectedPlatforms.includes('youtube') && (
              <div>
                <div className={`text-xs font-medium mb-2 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                  THUMBNAIL
                </div>
                <img
                  src={thumbnailPreview}
                  alt="Thumbnail preview"
                  className="w-full max-w-xs rounded-lg border-2 border-transparent"
                />
              </div>
            )}

            {/* Title */}
            <div>
              <div className={`text-xs font-medium mb-1 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                TITLE
              </div>
              <div className={`text-sm ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                {title}
              </div>
            </div>

            {/* Platforms */}
            <div>
              <div className={`text-xs font-medium mb-2 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                PLATFORMS
              </div>
              <div className="flex gap-2">
                {selectedPlatforms.includes('tiktok') && (
                  <div className="flex items-center gap-2 px-3 py-1 rounded-lg bg-black text-white text-sm">
                    <Icons.TikTok /> TikTok
                  </div>
                )}
                {selectedPlatforms.includes('youtube') && (
                  <div className="flex items-center gap-2 px-3 py-1 rounded-lg bg-red-600 text-white text-sm">
                    <Icons.YouTube /> YouTube
                  </div>
                )}
              </div>
            </div>

            {/* Schedule */}
            <div>
              <div className={`text-xs font-medium mb-1 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                SCHEDULE
              </div>
              <div className={`text-sm ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                {scheduleType === 'now' ? (
                  <span className="text-success">‚ö° Upload Now</span>
                ) : (
                  <span>üìÖ {new Date(`${scheduleDate}T${scheduleTime}`).toLocaleString()}</span>
                )}
              </div>
            </div>

            {/* Hashtags */}
            {hashtags && (
              <div>
                <div className={`text-xs font-medium mb-1 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                  HASHTAGS
                </div>
                <div className={`text-sm ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                  {hashtags}
                </div>
              </div>
            )}

            {/* Privacy */}
            <div>
              <div className={`text-xs font-medium mb-1 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                PRIVACY
              </div>
              <div className="flex items-center gap-2">
                {privacy === 'public' && (
                  <span className="text-success">
                    üåç Public - Everyone can see
                  </span>
                )}
                {privacy === 'unlisted' && (
                  <span className="text-warning">
                    üîó Unlisted - Only with link
                  </span>
                )}
                {privacy === 'private' && (
                  <span className="text-error">
                    üîí Private - Only you
                  </span>
                )}
              </div>
            </div>
          </div>

          {result && (
            <div className={`p-4 rounded-xl ${isDark ? 'bg-success/10' : 'bg-green-50'}`}>
              <div className="flex items-start gap-3">
                <div className="text-success text-xl">‚úì</div>
                <div>
                  <div className={`font-medium ${isDark ? 'text-success' : 'text-green-700'}`}>
                    Video Uploaded Successfully!
                  </div>
                  <div className={`text-sm mt-1 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                    Publish ID: {result.publish_id}
                  </div>
                  {result.scheduledFor && (
                    <div className={`text-sm mt-1 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                      Scheduled for: {new Date(result.scheduledFor).toLocaleString()}
                    </div>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      );

      return (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4">
          <div className={`w-full max-w-2xl rounded-2xl p-6 ${isDark ? 'bg-surface border border-surface-border' : 'bg-white border border-gray-200'} animate-slide-up max-h-[90vh] overflow-y-auto`}>
            {/* Header */}
            <div className="flex items-center justify-between mb-6">
              <div>
                <h2 className={`text-xl font-bold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                  Upload Video
                </h2>
                <div className={`text-sm ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>
                  Step {step} of 4
                </div>
              </div>
              <button onClick={handleClose} className={`p-2 rounded-lg ${isDark ? 'hover:bg-background-700 text-gray-400' : 'hover:bg-gray-100 text-gray-600'}`}>
                ‚úï
              </button>
            </div>

            {/* Progress bar */}
            <div className="flex gap-2 mb-6">
              {[1, 2, 3, 4].map((s) => (
                <div
                  key={s}
                  className={`flex-1 h-1 rounded-full transition-smooth ${
                    s <= step ? 'bg-primary' : isDark ? 'bg-background-900' : 'bg-gray-200'
                  }`}
                />
              ))}
            </div>

            {/* Error */}
            {error && (
              <div className={`mb-4 p-3 rounded-xl text-sm break-words ${isDark ? 'bg-error/10 text-error' : 'bg-red-50 text-red-600'}`}>
                {error}
              </div>
            )}

            {/* Step content */}
            {step === 1 && renderStep1()}
            {step === 2 && renderStep2()}
            {step === 3 && renderStep3()}
            {step === 4 && renderStep4()}

            {/* Buttons */}
            <div className="flex gap-3 mt-6">
              {step > 1 && step < 4 && !result ? (
                <button
                  onClick={handleBack}
                  className={`px-5 py-3 rounded-xl font-medium transition-smooth ${
                    isDark
                      ? 'bg-background-700 text-gray-200 hover:bg-background-600'
                      : 'bg-gray-200 text-gray-900 hover:bg-gray-300'
                  }`}
                >
                  Back
                </button>
              ) : (
                <button
                  onClick={handleClose}
                  disabled={loading}
                  className={`px-5 py-3 rounded-xl font-medium transition-smooth ${
                    isDark
                      ? 'bg-background-700 text-gray-200 hover:bg-background-600'
                      : 'bg-gray-200 text-gray-900 hover:bg-gray-300'
                  }`}
                >
                  {result ? 'Close' : 'Cancel'}
                </button>
              )}

              {step < 4 && !result && (
                <button
                  onClick={handleNext}
                  disabled={(step === 1 && !file) || loading}
                  className="flex-1 px-5 py-3 rounded-xl bg-primary text-white font-medium hover:bg-primary-600 transition-smooth disabled:opacity-50"
                >
                  {step === 3 ? 'Review' : 'Next'}
                </button>
              )}

              {step === 4 && !result && (
                <button
                  onClick={handleUpload}
                  disabled={loading}
                  className="flex-1 px-5 py-3 rounded-xl bg-primary text-white font-medium hover:bg-primary-600 transition-smooth disabled:opacity-50 flex items-center justify-center gap-2"
                >
                  {loading ? (
                    <>
                      <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                      Uploading...
                    </>
                  ) : (
                    <>
                      <div className="text-lg">üöÄ</div>
                      Upload Now
                    </>
                  )}
                </button>
              )}
            </div>
          </div>
        </div>
      );
    }

    // ====== TOAST COMPONENT ======
    function Toast({ message, isDark }) {
      if (!message) return null;

      return (
        <div className={`fixed top-6 right-6 z-50 animate-slide-in-right ${isDark ? 'text-white' : 'text-gray-900'}`}>
          <div className={`px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 border border-yellow-500/30 ${
            isDark ? 'bg-gray-800' : 'bg-white'
          }`}>
            <div className="flex-shrink-0">
              <svg className="w-6 h-6 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
              </svg>
            </div>
            <div className="flex-1">
              <p className="font-medium">{message}</p>
            </div>
          </div>
          <style>{`
            @keyframes slide-in-right {
              from {
                transform: translateX(100%);
                opacity: 0;
              }
              to {
                transform: translateX(0);
                opacity: 1;
              }
            }
            .animate-slide-in-right {
              animation: slide-in-right 0.3s ease-out;
            }
          `}</style>
        </div>
      );
    }

    // ====== MAIN APP ======
    function App() {
      const [lang, setLang] = useState('en');
      const [isDark, setIsDark] = useState(true);
      const [currentPage, setCurrentPage] = useState('dashboard');
      const [profiles, setProfiles] = useState({}); // { tiktok: {...}, youtube: {...} }
      const [showAuthModal, setShowAuthModal] = useState(false);
      const [showUploadModal, setShowUploadModal] = useState(false);
      const [selectedProjectId, setSelectedProjectId] = useState(null);
      const [stats, setStats] = useState(kpiData);
      const [toast, setToast] = useState(null);
      const [activities, setActivities] = useState([]);

      const showToast = (message) => {
        setToast(message);
        setTimeout(() => setToast(null), 3000);
      };

      const handleUploadSuccess = (uploadData) => {
        // Update stats
        setStats(prev => ({
          ...prev,
          uploaded: { ...prev.uploaded, value: prev.uploaded.value + 1 }
        }));

        // Add activity
        const newActivity = {
          id: Date.now(),
          type: 'upload',
          platform: uploadData.platform || 'TikTok',
          video: uploadData.videoName || 'Uploaded video',
          time: lang === 'ru' ? '–¢–æ–ª—å–∫–æ —á—Ç–æ' : 'Just now',
          status: 'success'
        };
        setActivities(prev => [newActivity, ...prev]);
      };

      const t = translations[lang];

      // Toggle theme
      const toggleTheme = () => {
        setIsDark(!isDark);
      };

      // Apply theme to body
      useEffect(() => {
        if (isDark) {
          document.body.classList.remove('light');
          document.body.classList.add('dark');
        } else {
          document.body.classList.remove('dark');
          document.body.classList.add('light');
        }
      }, [isDark]);

      // Load user profiles on mount
      useEffect(() => {
        const loadProfiles = async () => {
          try {
            const data = await apiRequest('/api/me');
            setProfiles(data.profiles || {});
          } catch (e) {
            console.log('Not logged in');
          }
        };
        loadProfiles();
      }, []);

      // Load stats
      useEffect(() => {
        const loadStats = async () => {
          try {
            const data = await apiRequest('/api/stats');
            setStats({
              uploaded: { value: data.uploaded, change: 12.5, trend: 'up' },
              scheduled: { value: data.scheduled, change: 8.2, trend: 'up' },
              published: { value: data.published, change: -2.1, trend: 'down' },
              errors: { value: data.errors, change: -15.3, trend: 'up' },
            });
          } catch (e) {
            console.log('Stats not loaded');
          }
        };
        loadStats();
      }, []);

      const handleAuthSuccess = (newProfile) => {
        setProfiles(prev => ({
          ...prev,
          [newProfile.platform]: newProfile
        }));
      };

      const handleLogout = async (platform) => {
        try {
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –±—ç–∫–µ–Ω–¥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
          await apiRequest('/api/oauth/logout', {
            method: 'POST',
            body: JSON.stringify({ platform }),
          });
        } catch (error) {
          console.log('[Logout] Server error:', error);
          // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å failed - –æ—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
        }

        // –û—á–∏—â–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        setProfiles(prev => {
          const newProfiles = { ...prev };
          delete newProfiles[platform];
          return newProfiles;
        });

        showToast({
          title: lang === 'ru' ? '–ê–∫–∫–∞—É–Ω—Ç –æ—Ç–∫–ª—é—á—ë–Ω' : 'Account disconnected',
          description: lang === 'ru'
            ? `${platform === 'tiktok' ? 'TikTok' : 'YouTube'} ${lang === 'ru' ? '–æ—Ç–∫–ª—é—á—ë–Ω –æ—Ç –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞' : 'has been disconnected'}`
            : `${platform === 'tiktok' ? 'TikTok' : 'YouTube'} has been disconnected from your account`,
          type: 'success',
        });
      };

      const handleUploadClick = (projectId) => {
        const hasProfile = Object.keys(profiles).length > 0;
        if (!hasProfile) {
          setShowAuthModal(true);
        } else {
          setSelectedProjectId(projectId);
          setShowUploadModal(true);
        }
      };

      const renderPage = () => {
        switch (currentPage) {
          case 'dashboard':
            return <DashboardPage onUpload={() => handleUploadClick(null)} setCurrentPage={setCurrentPage} profiles={profiles} activities={activities} stats={stats} />;
          case 'projects':
            return <ProjectsPage onUpload={(id) => handleUploadClick(id)} />;
          case 'scheduler':
            return <SchedulerPage />;
          case 'uploads':
            return <div className="flex items-center justify-center h-96">
              <div className="text-center">
                <div className="text-6xl mb-4">üì§</div>
                <div className={`text-lg font-semibold ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                  Uploads Page
                </div>
                <button
                  onClick={() => handleUploadClick(null)}
                  className="mt-4 px-6 py-3 rounded-xl bg-primary text-white font-medium hover:bg-primary-600 transition-smooth"
                >
                  Upload New Video
                </button>
              </div>
            </div>;
          case 'analytics':
            return <div className="flex items-center justify-center h-96">
              <div className="text-center">
                <div className="text-6xl mb-4">üìä</div>
                <div className={`text-lg font-semibold ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                  Analytics Page
                </div>
              </div>
            </div>;
          case 'settings':
            return (
              <div className="space-y-6 animate-fade-in">
                <div>
                  <h1 className={`text-2xl font-bold mb-4 ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>Settings</h1>

                  <div className={`border rounded-2xl p-6 ${isDark ? 'bg-surface border-surface-border' : 'bg-white border-gray-200'}`}>
                    <h2 className={`text-lg font-semibold mb-4 ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                      Connected Accounts
                    </h2>

                    <div className="space-y-4">
                      {/* TikTok */}
                      <div className={`p-4 rounded-xl ${isDark ? 'bg-background-800' : 'bg-gray-50'}`}>
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-4">
                            {(() => {
                              console.log('[TikTok Profile Debug]', profiles.tiktok);
                              const hasAvatar = profiles.tiktok?.avatar_url;
                              console.log('[TikTok Avatar URL]', hasAvatar);
                              return null;
                            })()}
                            {profiles.tiktok?.avatar_url ? (
                              <img
                                src={profiles.tiktok.avatar_url}
                                alt={profiles.tiktok.display_name}
                                className="w-12 h-12 rounded-xl object-cover"
                                onError={(e) => {
                                  console.log('[TikTok Avatar Error]', e);
                                  e.target.style.display = 'none';
                                  e.target.nextSibling.style.display = 'flex';
                                }}
                              />
                            ) : (
                              <div className="w-12 h-12 rounded-xl bg-black text-white flex items-center justify-center">
                                <Icons.TikTok />
                              </div>
                            )}
                            <div>
                              {profiles.tiktok ? (
                                <>
                                  <div className={`text-base font-medium ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                                    {profiles.tiktok.display_name}
                                  </div>
                                  <div className={`text-sm ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                                    {profiles.tiktok.followers_count
                                      ? `${profiles.tiktok.followers_count?.toLocaleString()} followers`
                                      : (profiles.tiktok.handle || 'Connected')
                                    }
                                  </div>
                                </>
                              ) : (
                                <div className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                  Not connected
                                </div>
                              )}
                            </div>
                          </div>
                          <div className="flex gap-2">
                            {profiles.tiktok ? (
                              <>
                                <button
                                  onClick={() => {
                                    setCurrentPage('settings');
                                    setShowAuthModal(true);
                                  }}
                                  className={`px-4 py-2 rounded-xl text-sm font-medium transition-smooth ${isDark ? 'bg-background-700 text-gray-300 hover:bg-background-600' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                >
                                  Reconnect
                                </button>
                                <button
                                  onClick={() => handleLogout('tiktok')}
                                  className={`px-4 py-2 rounded-xl text-sm font-medium transition-smooth bg-red-100 text-red-700 hover:bg-red-200`}
                                >
                                  Disconnect
                                </button>
                              </>
                            ) : (
                              <button
                                onClick={() => {
                                  setCurrentPage('settings');
                                  setShowAuthModal(true);
                                }}
                                className="px-4 py-2 rounded-xl text-sm font-medium transition-smooth bg-black text-white hover:bg-gray-800"
                              >
                                Connect
                              </button>
                            )}
                          </div>
                        </div>
                      </div>

                      {/* YouTube */}
                      <div className={`p-4 rounded-xl ${isDark ? 'bg-background-800' : 'bg-gray-50'}`}>
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-4">
                            <div className="w-12 h-12 rounded-xl bg-red-600 text-white flex items-center justify-center">
                              <Icons.YouTube />
                            </div>
                            <div>
                              {profiles.youtube ? (
                                <>
                                  <div className={`text-base font-medium ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                                    {profiles.youtube.title}
                                  </div>
                                  <div className={`text-sm ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                                    {profiles.youtube.subscriber_count?.toLocaleString()} subscribers
                                  </div>
                                </>
                              ) : (
                                <div className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                  Not connected
                                </div>
                              )}
                            </div>
                          </div>
                          <div className="flex gap-2">
                            {profiles.youtube ? (
                              <>
                                <button
                                  onClick={() => {
                                    setCurrentPage('settings');
                                    setShowAuthModal(true);
                                  }}
                                  className={`px-4 py-2 rounded-xl text-sm font-medium transition-smooth ${isDark ? 'bg-background-700 text-gray-300 hover:bg-background-600' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                >
                                  Reconnect
                                </button>
                                <button
                                  onClick={() => handleLogout('youtube')}
                                  className={`px-4 py-2 rounded-xl text-sm font-medium transition-smooth bg-red-100 text-red-700 hover:bg-red-200`}
                                >
                                  Disconnect
                                </button>
                              </>
                            ) : (
                              <button
                                onClick={() => {
                                  setCurrentPage('settings');
                                  setShowAuthModal(true);
                                }}
                                className="px-4 py-2 rounded-xl text-sm font-medium transition-smooth bg-red-600 text-white hover:bg-red-700"
                              >
                                Connect
                              </button>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          default:
            return (
              <div className="flex items-center justify-center h-96">
                <div className="text-center">
                  <div className="text-6xl mb-4">üöß</div>
                  <div className={`text-lg font-semibold ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                    Coming Soon
                  </div>
                </div>
              </div>
            );
        }
      };

      return (
        <TranslationContext.Provider value={{ lang, setLang, t, isDark }}>
          <ThemeContext.Provider value={{ isDark, toggleTheme }}>
            <div className={`min-h-screen grid-pattern ${isDark ? 'dark' : 'light'}`}>
              <Sidebar currentPage={currentPage} setCurrentPage={setCurrentPage} profiles={profiles} onConnectAccount={() => setShowAuthModal(true)} onShowToast={showToast} />

              <div className="ml-64">
                <Header />

                <main className="p-6">
                  {renderPage()}
                </main>
              </div>

              <AuthModal
                isOpen={showAuthModal}
                onClose={() => setShowAuthModal(false)}
                onSuccess={handleAuthSuccess}
              />

              <UploadModal
                isOpen={showUploadModal}
                onClose={() => setShowUploadModal(false)}
                projectId={selectedProjectId}
                onUploadSuccess={handleUploadSuccess}
              />

              <Toast message={toast} isDark={isDark} />
            </div>
          </ThemeContext.Provider>
        </TranslationContext.Provider>
      );
    }

    // ====== OAUTH CALLBACK HANDLER ======
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ OAuth callback (–æ—Ç TikTok/YouTube)
    const urlParams = new URLSearchParams(window.location.search);
    const oauthCode = urlParams.get('code');
    const oauthState = urlParams.get('state');
    const oauthError = urlParams.get('error');

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    console.log('[Callback] URL params:', { oauthCode: oauthCode?.substring(0, 20) + '...', oauthState, oauthError, hasOpener: !!window.opener });
    console.log('[Callback] Full URL:', window.location.href);

    // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–¥/–æ—à–∏–±–∫–∞ –æ—Ç OAuth ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ sessionStorage
    if (oauthCode || oauthError) {
      console.log('[Callback] OAuth callback detected! Saving to sessionStorage...');

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ sessionStorage
      const oauthData = {
        code: oauthCode,
        state: oauthState,
        error: oauthError,
        timestamp: Date.now()
      };
      sessionStorage.setItem('oauth_callback', JSON.stringify(oauthData));

      // –£–±–∏—Ä–∞–µ–º –∫–æ–¥ –∏–∑ URL (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
      window.history.replaceState({}, document.title, window.location.pathname);

      // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ ‚Äî –ø—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∑–∞–∫—Ä—ã—Ç—å popup
      if (window.opener) {
        console.log('[Callback] Has parent window, trying postMessage...');
        try {
          window.opener.postMessage({
            type: 'oauth_code',
            code: oauthCode,
            state: oauthState,
            error: oauthError
          }, '*');
          console.log('[Callback] Message sent to parent');
        } catch (e) {
          console.error('[Callback] postMessage failed:', e);
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ
        document.body.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; background: #0a0a0b; color: white;">
            <div style="text-align: center;">
              <h2 style="color: #10b981; margin-bottom: 1rem;">‚úì –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</h2>
              <p style="color: #94a3b8;">–≠—Ç–æ –æ–∫–Ω–æ –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å</p>
            </div>
          </div>
        `;

        setTimeout(() => {
          window.close();
        }, 1500);
      } else {
        console.log('[Callback] No parent window, reloading page to process code...');
        // –ï—Å–ª–∏ –Ω–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞ ‚Äî –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–¥
        window.location.reload();
      }
    } else {
      console.log('[Callback] Not an OAuth callback, loading app...');
      // ====== INIT ======
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    }
  </script>
</body>
</html>
